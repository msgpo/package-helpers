#!/bin/bash
#
#    Copyright (C) 2008  Peter Stevenson
#    Copyright (C) 2008  Rubén Rodríguez <ruben@trisquel.info>
#
#    This program is free software; you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation; either version 2 of the License, or
#    (at your option) any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program; if not, write to the Free Software
#    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA
#

VERSION=1

. ./config

cat << EOF > debian/firefox.js
pref("extensions.update.enabled", true);
// Use LANG environment variable to choose locale
pref("intl.locale.matchOS", true);
// Disable default browser checking.
pref("browser.shell.checkDefaultBrowser", false);
// Prevent EULA dialog to popup on first run
pref("browser.EULA.override", true);

pref("general.useragent.vendor", "Trisquel");
pref("general.useragent.vendorComment", "dwyn");
pref("general.useragent.vendorSub", "3.0");
pref ("startup.homepage_override_url" , "http://trisquel.info/newbrowser");
pref ("startup.homepage_welcome_url" , "http://trisquel.info/welcome");

// Preferences for the Get Add-ons panel
pref ("extensions.update.notifyUser", false);
pref ("extensions.getAddons.showPane", false);
pref ("extensions.getAddons.browseAddons", "http://trisquel.info/browser");
pref ("extensions.getAddons.maxResults", 5);
pref ("extensions.getAddons.recommended.browseURL", "http://trisquel.info/browser");
pref ("extensions.getAddons.recommended.url", "http://trisquel.info/browser");
pref ("extensions.getAddons.search.browseURL", "http://trisquel.info/browser");
pref ("extensions.getAddons.search.url", "http://trisquel.info/browser");
pref ("extensions.getMoreExtensionsURL" , "http://trisquel.info/browser");
pref ("extensions.getMorePluginsURL" , "http://trisquel.info/browser");
pref ("extensions.getMoreThemesURL" , "http://trisquel.info/browser");

// Dictionary download preference
pref("browser.dictionaries.download.url", "http://trisquel.info/browser");

EOF

#Remove ubuntu package search engine
sed -i '/debsearch/d' debian/firefox-3.5.install

cat << EOF > debian/distribution.ini
[Global]
id=trisquel
version=1.0
about=Mozilla based browser for Trisquel GNU/Linux

[Preferences]
app.distributor = “trisquel”
app.distributor.channel = “trisquel”
app.partner.ubuntu = “trisquel”
EOF

sed -i /reload_new_plugins/d debian/patches/series
cp $WD/DATA/firefox-3.5-setup.sh debian/
#The firefox-setup script needs to be launched during the pre-build stage
sed 's:\(^pre-build.*$\):\1\n\tsh debian/firefox-3.5-setup.sh:' -i debian/rules

echo | dch -D $RELEASE -v $(sed  -n '1s#^.*(\(.*\)).*#\1'${DISTRONAME_L}${VERSION}'#p' debian/changelog)  "Firefox branding removed, abrowser tuned up for Trisquel"
compile

